<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Place Search</title>
    <link rel="stylesheet" href="https://gitcdn.link/repo/angular/bower-material/master/angular-material.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>

    <!-- font awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified JavaScript -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>

    <!-- Angular Material requires Angular.js Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-aria.min.js"></script>

    <!-- Angular Material Library -->
    <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.6/angular-material.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB9FQSZUWndH5dSqIQCLF-XrOW3kJ6Hiyc&libraries=places"
        async defer></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.0/moment.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <script>
        var position = "";
        $(document).ready(function () { 
            $("#invalid_input").hide();
            $("#table_loading").hide();
            $("#table_noRecordFav").hide();
            $("#table_noRecord").hide();
            $("#table_error").hide();
            $("#googleTable_noRecord").hide();
            $("#yelpReviewTable_noRecord").hide();
            $("#currentDetail").hide();
            $("#currentDetail").prop("disabled", true);
            $("#search").prop("disabled", true);
            $("#otherLocationText").prop("disabled", true);
            $("#otherLocation").on('click',function() { 
                $("#otherLocationText").prop("disabled", false);
                if (position != "" 
                    && !$("#keyword").hasClass("is-invalid")
                    && $("#keyword").val() != ""
                    && !$("#otherLocationText").hasClass("is-invalid")
                    && $("#otherLocationText").val() != "") {           
                    $("#search").prop("disabled", false);
                } else {
                    $("#search").prop("disabled", true);
                }
            });
            $("#currentLocation").on('click',function() { 
                $("#otherLocationText").removeClass("is-invalid");
                $("#invalid_input_2").hide();
                $("#otherLocationText").prop("disabled", true);

                if (position != "" 
                    && !$("#keyword").hasClass("is-invalid")
                    && $("#keyword").val() != "") {
                    $("#search").prop("disabled", false);
                } else {
                    $("#search").prop("disabled", true);
                }
            });

            // var otherLocation = document.getElementById('otherLocationText');
            // var otherLocationAutocomplete = new google.maps.places.Autocomplete(
            //     otherLocation, {placeIdOnly: true});
            $("#origin-input").keyup(function () {
                var value = $("#origin-input").val();
                if (value == "" || !value.match(/^\w[\w ]*$/)) {
                    $("#getDirection").prop("disabled", true);
                } else {
                    $("#getDirection").prop("disabled", false);
                }
            });

            $("#origin-input").focus(function () {
                var value = $("#origin-input").val();
                if (value == "" || !value.match(/^\w[\w ]*$/)) {
                    $("#getDirection").prop("disabled", true);
                } else {
                    $("#getDirection").prop("disabled", false);
                }
            });


            $("#keyword").keyup(function () {
                var value = $("#keyword").val();
                if (value == "" || !value.match(/^\w[\w ]*$/)) {
                    $("#search").prop("disabled", true);
                    if (!$("#keyword").hasClass("is-invalid")) {
                        $("#keyword").addClass("is-invalid");
                    }
                    $("#invalid_input").show();
                }
                else {
                    if ($("#keyword").hasClass("is-invalid")) {
                        $("#keyword").removeClass("is-invalid");
                    }
                    // $("#otherLocation").checked
                    if (position == "" 
                        || ($("#otherLocation").checked && $("#otherLocationText").val() == ""
                        )) {
                        $("#search").prop("disabled", true);
                    } else {
                        $("#search").prop("disabled", false);
                    }
                    
                    $("#invalid_input").hide();
                }
            });
            $("#origin-input").keyup(function () {
                getPlaceIdByAddress($("#origin-input").val());
            });

            $("#otherLocationText").keyup(function () {
                var value = $("#otherLocationText").val();       
                if (value == "" || !value.match(/^\w[\w ]*$/)) {
                    // $("#search").prop("disabled", true);
                    if (!$("#otherLocationText").hasClass("is-invalid")) {
                        $("#otherLocationText").addClass("is-invalid");
                    }
                    $("#invalid_input_2").show();
                }
                else {
                    if ($("#otherLocationText").hasClass("is-invalid")) {
                        $("#otherLocationText").removeClass("is-invalid");
                    }
                    if (position != "" 
                        && !$("#keyword").hasClass("is-invalid")
                        && $("#keyword").val() != "") {
                        $("#search").prop("disabled", false);
                    } else {
                        $("#search").prop("disabled", true);
                    }
                    $("#invalid_input_2").hide();
                }
            });

            $("#otherLocationText").focus(function () {
                var value = $("#otherLocationText").val();       
                if (value == "" || !value.match(/^\w[\w ]*$/)) {
                    // $("#search").prop("disabled", true);
                    if (!$("#otherLocationText").hasClass("is-invalid")) {
                        $("#otherLocationText").addClass("is-invalid");
                    }
                    $("#invalid_input_2").show();
                }
                else {
                    if ($("#otherLocationText").hasClass("is-invalid")) {
                        $("#otherLocationText").removeClass("is-invalid");
                    }
                    if (position != "" 
                        && !$("#keyword").hasClass("is-invalid")
                        && $("#keyword").val() != "") {
                        $("#search").prop("disabled", false);
                    } else {
                        $("#search").prop("disabled", true);
                    }
                    $("#invalid_input_2").hide();
                }
            });

            

            $(".dropdown-menu a").click(function(){
                $(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
                $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
            });
            
            $("#keyword").focus(function () {
                var value = $("#keyword").val();
                if (value == "" || !value.match(/^\w[\w ]*$/)) {
                    $("#search").prop("disabled", true);
                    if (!$("#keyword").hasClass("is-invalid")) {
                        $("#keyword").addClass("is-invalid");
                    }
                    $("#invalid_input").show();
                }
                else {
                    if ($("#keyword").hasClass("is-invalid")) {
                        $("#keyword").removeClass("is-invalid");
                    }
                    // $("#otherLocation").checked
                    if (position == "" 
                        || ($("#otherLocation").checked && $("#otherLocationText").val() == ""
                        )) {
                        $("#search").prop("disabled", true);
                    } else {
                        $("#search").prop("disabled", false);
                    }
                    
                    $("#invalid_input").hide();
                }
            });

            $("#currentLocation").focus(function () {
                $("#otherLocationText").prop("disabled", true);
                $("#otherLocationText").val('');
            });

            $("#otherLocation").focus(function () {
                var otherLocation = document.getElementById('otherLocationText');
                var otherLocationAutocomplete = new google.maps.places.Autocomplete(
                    otherLocation, {placeIdOnly: true});
                $("#otherLocationText").prop("disabled", false);
            });
            // console.log("??");
            $.ajax({
                url: "http://ip-api.com/json",
                // type: "GET",
                // contentType: 'application/x-www-form-urlencoded', //here it is
                // crossDomain: true,
                success: function (response) {
                    // console.log(response)
                    // console.log(response);
                    var lat = response.lat;
                    var lon = response.lon;
                    position = lat + "," + lon;
                    // console.log(position);
                }
            }); 
        });

        // var
        var favorites = [];
        var nextToken = "";
        var previousJsons = [];
        var currentJson;
        var currentPlaceId = "";
        var myPlaceId = "";
        var originPlaceId = "";
        var destinationPlaceId = "";
        var originAddressInput = "";
        // stack.push stack.pop()
        // localStorage.setItem("placeID", "display information of this place");
        // use localStorage to set favorite list

        var myApp = angular.module('MyApp', ['ngMaterial', 'ngAnimate'])
        myApp.controller('MainCtrl', MainCtrl);
        myApp.controller('AppController', AppController);

        function MainCtrl($scope, $rootScope, $http, $interval) {
            $scope.showFull = true;
            $scope.hasNext = false;
            $scope.hasPrevious = false;
            $scope.propertyName = "";
            $scope.reverse = true;
            $scope.bool = true;
            $scope.search_types = [{ id: "default", value: "Default" }, { id: "airport", value: "Airport" }, { id: "amusement_park", value: "Amusement Park" }, 
                                   { id: "aquarium", value: "Aquarium" }, { id: "art_gallery", value: "Art Gallery" },
                                   { id: "bakery", value: "Bakery" }, { id: "bar", value: "Bar" }, { id: "beauty_salon", value: "Beauty Salon" }, { id: "bowling_alley", value: "Bowling Alley" }, 
                                   { id: "bus_station", value: "Bus Station" }, { id: "cafe", value: "Cafe" }, 
                                   { id: "campground", value: "Campground" }, { id: "car_rental", value: "Car Rental" },  
                                   { id: "casino", value: "Casino" }, { id: "lodging", value: "Lodging" }, 
                                   { id: "movie_theater", value: "Movie Theater" }, { id: "museum", value: "Museum" }, 
                                   { id: "night_club", value: "Night Club" }, { id: "park", value: "Park" }, { id: "parking", value: "Parking" },
                                   { id: "restaurant", value: "Restaurant" }, { id: "shopping_mall", value: "Shopping Mall" }, 
                                   { id: "stadium", value: "Stadium" }, { id: "subway_station", value: "Subway Station" }, 
                                   { id: "taxi_stand", value: "Taxi Stand" }, { id: "transit_station", value: "Transit Station" }, { id: "train_station", value: "Train Station" }, 
                                   { id: "travel_agency", value: "Travel Agency" }, { id: "zoo", value: "Zoo" }];
            
            $scope.orderMethods = [ { id: "default_order", value: "Default Order" }, { id: "highest_rating", value: "Highest Rating" }, 
                                   { id: "lowest_rating", value: "Lowest Rating" }, { id: "most_recent", value: "Most Recent" },  
                                   { id: "least_recent", value: "Least Recent" }];
            $scope.places = [];
            $scope.propertyName = $scope.orderMethods[0].id
            $scope.selected = $scope.search_types[0].id;

            $scope.sortBy = function (propertyName) {
                console.log(propertyName);
                if (propertyName == "default") {
                    $scope.propertyName = "";
                    $scope.reverse = true;
                }
                if (propertyName == "lowest") {
                    $scope.propertyName = "rating";
                    $scope.reverse = false;
                }
                if (propertyName == "highest") {
                    $scope.propertyName = "rating";
                    $scope.reverse = true;
                }
                if (propertyName == "mostRecent") {
                    $scope.propertyName = "time";
                    $scope.reverse = true;
                }
                if (propertyName == "leastRecent") {
                    $scope.propertyName = "time";
                    $scope.reverse = false;
                }   
            };

            $scope.slideShow = function (placeId) {
                $scope.showFull = false;
                $("#currentDetail").prop("disabled", false);
                $scope.bool = true;
                currentPlaceId = placeId;
                console.log(placeId);
                generateDetailTable(placeId);            
            }
            
            $scope.showGoogle = function() {
                if ($scope.googleReviews.length != 0) {
                    $scope.bool = 'googleShow';
                    console.log("google");
                    $("#googleReviewTableContent").show();
                    $("#googleTable_noRecord").hide();
                } else {
                    $scope.bool = 'googleNoRecord';
                    $("#googleReviewTableContent").hide();
                    $("#googleTable_noRecord").show();
                }

                console.log("showGoogle:"+$scope.bool);
            }

            $scope.showYelp = function() {
                if ($scope.yelpReviews.length != 0) {
                    $scope.bool = 'yelpShow';
                    $("#yelpReviewTableContent").show();
                    $("#yelpReviewTable_noRecord").hide();
                    console.log("show yelp" + $scope.yelpReviews.length);
                } else {
                    $scope.bool = 'yelpNoRecord';
                    $("#yelpReviewTableContent").hide();
                    $("#yelpReviewTable_noRecord").show();
                    console.log("yelpnorecord" + $scope.yelpReviews.length);
                }
                console.log("showYelp:"+$scope.bool);
                console.log($scope.yelpReviews);
            }

            $scope.slideCurrentShow = function() {
                document.getElementById("nav-info-tab").click();
                $scope.showFull = false;
            }

            $scope.showPrevious = function () {

                var prev = previousJsons.pop();
                if(previousJsons.length == 0) {
                    $scope.hasPrevious = false;
                } 
                $scope.hasNext = true;
                // var prevJson = ;
                console.log("prev:");
                console.log(prev);
                if($("#resultTable").html(generateResultsTable(prev.results))) {
                    addFavClick();
                    addDetailClick();
                    addFavColor();
                }
                nextToken = prev.next_page_token;
            }

            $scope.showNext = function () {
                if (nextToken != "") {
                    previousJsons.push(currentJson);
                    $http.get('http://kailaihm8-env.us-east-2.elasticbeanstalk.com/nearbyNext?nextToken='+ nextToken).then(function successCallback(response) {
                        // console.log(rest);
                        var content = response.data;
                        // console.log(content["error"]);
                        $("#table_noRecord").hide();
                        $("#table_error").hide();
                        // console.log(content);
                        if (content["error"] == 0) {
                            // self define a data  and system carry a data
                            // console.log("content");
                            // console.log(content);
                            var content = JSON.parse(content.data);
                            $("#table_loading").hide(); 
                            if($("#resultTable").html(generateResultsTable(content.results))) {
                                addFavClick();
                                addDetailClick();
                                addFavColor();
                            }
                            if(content.next_page_token && content.next_page_token != "") {
                                // console.log("hasNext");
                                // console.log(content);
                                nextToken = content.next_page_token;
                                // console.log(nextToken);
                            } else {
                                $scope.hasNext = false;
                            }
                            $scope.hasPrevious = true;
                        } else if (content["error"] == 1) {
                            $("#table_noRecord").show();
                        } else {
                            $("#table_error").show();
                        }
                    });
                }
            }
            
            $scope.clearShow = function () {
                $("#keyword").val('');
                if ($("#keyword").hasClass("is-invalid")) {
                    $("#keyword").removeClass("is-invalid");
                }
                $("#search").prop("disabled", true);
                $("#invalid_input").hide();
                $("#invalid_input_2").hide();
                $("#currentDetail").hide();
                $("#otherLocationText").val('');
                $("#table_noRecord").hide();
                favorites = [];
                nextToken = "";
                previousJsons = [];
                currentJson;
                currentPlaceId = "";
                originPlaceId = "";
                destinationPlaceId = "";
                $scope.showFull = true;
                $scope.hasNext = false;
                $scope.hasPrevious = false;
                $scope.propertyName = "";
                $scope.reverse = true;
                $scope.places = [];
                $("#resultTable").html("");
            }
            
            $scope.refreshFavorites = function () {
                $scope.showFull = true;
                retrieveLocalStorage();
                if (favorites.length > 0) {
                    $("#table_noRecordFav").hide();
                    // var html = generateFavoritesable();
                    if($("#favoriteTable").html(generateFavoritesable())) {
                        addTrashClick();
                        addDetailClick();
                    }
                } else {
                    if($("#favoriteTable").html(""));
                    $("#table_noRecordFav").show();
                }
            }
            
            $scope.refreshResults = function () {
                $scope.showFull = true;
            }

            $scope.getMyLocation = function () {
                $http.get('http://kailaihm8-env.us-east-2.elasticbeanstalk.com/myLocation?latlng='+ position).then(function successCallback(response) {
                    // console.log(rest);
                    console.log("position:" + position);
                    myPlaceId = response.data;
                    console.log("myPlaceId:"+myPlaceId);
                    myPlaceId = myPlaceId.substring(1, myPlaceId.length - 1);
                    console.log("myPlaceId:"+myPlaceId);
                });
            }

            $scope.showResult = function () {
                $scope.getMyLocation();
                initQueryResult();
                $scope.showFull = true;
                var keyword = escape($("#keyword").val());
                var category = $("#category").val();
                var dis = $("#distance").val();
                // console.log(category);
                var address = "";
                var distance = getDistance(dis);
                var start = escape($("[name=start]").val());
                // console.log(distance);
                if (start = "Other. Please specify:") {               
                    address = $("#otherLocationText").val();
                };
                originAddressInput = address;
                

                var rest = "keyword=" + keyword + "&category=" + category + "&distance=" + distance + 
                               "&address=" + address + "&position=" + position;
                // console.log(rest);
                // console.log(rest);
                $("#table_loading").show(); 
                $("#table_error").hide();
                $("#table_noRecord").hide();
                $http.get('http://kailaihm8-env.us-east-2.elasticbeanstalk.com/nearby?'+ rest).then(function successCallback(response) {
                    // console.log(rest);
                    previousJsons = [];
                    var content = response.data;
                    // console.log(content["error"]);
                    if (content["error"] == 0) {
                        // self define a data  and system carry a data
                        // console.log("content");
                        // console.log(content);
                        var content = JSON.parse(content.data);
                        $("#table_loading").hide(); 
                        $("#currentDetail").show();
                        currentJson = content;
                        if($("#resultTable").html(generateResultsTable(content.results))) {
                            addFavClick();
                            addDetailClick();
                            addFavColor();
                        }
                        if(content.next_page_token && content.next_page_token != "") {
                            // console.log("hasNext");
                            // console.log(content);
                            $scope.hasNext = true;
                            nextToken = content.next_page_token;
                            // console.log(nextToken);
                        }
                    } else if (content["error"] == 1) {
                        $("#table_loading").hide(); 
                        $("#table_noRecord").show();
                        $("#currentDetail").show();
                    } else {
                        $("#table_loading").hide();
                        $("#table_error").show();
                        $("#currentDetail").show();
                    }
                }, function errorCallback(response) {
                    $("#table_loading").hide();
                    $("#table_error").show();
                    $("#currentDetail").show();
                });
                // console.log("nextToken:"+nextToken);
            } 
        }

        function getPlaceIdByAddress(address) {
            var placeId = "";
            console.log("address:" + address);
            $.ajax({
                url: "http://kailaihm8-env.us-east-2.elasticbeanstalk.com/getPlaceIdByAddress?address=" + escape(address),
                // type: "GET",
                // contentType: 'application/x-www-form-urlencoded', //here it is
                // crossDomain: true,
                success: function (response) {
                    // console.log(response)
                    console.log("response");

                    console.log(response);
                    placeId = response;
                    console.log("placeId:"+placeId);
                    placeId = placeId.substring(1, placeId.length - 1);
                    console.log("placeId:"+placeId);
                    originPlaceId = placeId;
                }
            }); 
        }

        function AppController($scope, $rootScope, $http, $log, $timeout) {
        
        }

        function initQueryResult() {
            $("#table_error").hide();
            $("#table_noRecord").hide();
            $("#resultTable").html("");
        }
//         ??ChIJ7aVxnOTHwoARxKIntFtakKo1
// (index):221 ??ChIJGROLVcnHwoARb_c7LmECmdA1
        function addFavColor() {
            retrieveLocalStorage();
            for (key in favorites) {
                var favId = favorites[key].favId;
                // console.log("??" + favId);
                $("#" + favId + "1234").removeClass("far fa-star");
                $("#" + favId + "1234").addClass("yellow");
                $("#" + favId + "1234").addClass("fas fa-star");
                $("#" + favId + "12").removeClass("far fa-star");
                $("#" + favId + "12").addClass("yellow");
                $("#" + favId + "12").addClass("fas fa-star");
            }
        }
        

        function addTrashClick() {
            $(document).ready(function () { 
                $(".trash_btn").off('click').on('click',function() {
                    console.log("delete");
                    var trashId = $(this).attr('id');
                    trashId = trashId.substring(0, trashId.length - 1);
                    localStorage.removeItem(trashId);
                    $("#" + trashId + "12").removeClass("fas fa-star");
                    $("#" + trashId + "12").removeClass("yellow");
                    $("#" + trashId + "12").addClass("far fa-star");
                    retrieveLocalStorage();
                    if (favorites.length > 0) {
                        $("#table_noRecordFav").hide();
                        if($("#favoriteTable").html(generateFavoritesable())) {
                            addTrashClick();
                        }
                    } else {
                        if($("#favoriteTable").html(""));
                        $("#table_noRecordFav").show();
                    }
                    // localStorage.removeItem(trashId);
                });
            });
        }

        function addDetailClick() {
            $(document).ready(function () { 
                $(".detail_btn").off('click').on('click',function() {
                    document.getElementById("nav-info-tab").click();
                    var detailId = $(this).attr('id');
                    console.log(detailId);
                    var scope = angular.element(this).scope();
                    scope.$apply(function(){
                        scope.slideShow(detailId);
                    });
                });
            });
        }

        function addFavClick() {
            // add click function for fav
            $(document).ready(function () { 

                $(".star_btn").off('click').on('click',function() {
                    var tableData = $(this).parent().parent().children("td").map(function() {
                        return $(this).text();
                    });
                    var icon = $(this).parent().parent().find('img').attr('src') + "";
                    var favId = $(this).attr('id');
                    // console.log(favId);  
                    var starId = "";
                    var n = favId.substring(favId.length - 1, favId.length);
                    var name = tableData[1];
                    var address = tableData[2];
                    var isFav= true;
                    // if (n == "3") {
                    //     starId = favId + "4"
                    //     favId = favId.substring(0, favId.length - 3);
                    // } else {
                        starId = favId + "2";
                        favId = favId.substring(0, favId.length - 1);
                    // }
                    if (favId in localStorage) {
                        localStorage.removeItem(favId);
                        // console.log(starId);
                        $("#" + favId + "12").removeClass("fas fa-star");
                        $("#" + favId + "12").removeClass("yellow");
                        $("#" + favId + "12").addClass("far fa-star");
                        // $("#" + favId + "1234").removeClass("fas fa-star");
                        // $("#" + favId + "1234").removeClass("yellow");
                        // $("#" + favId + "1234").addClass("far fa-star");
                        // console.log("remfav");
                    } else {
                        var content = {};
                        content["icon"] = icon;
                        content["favId"] = favId;
                        content["name"] = name;
                        content["address"] = address;
                        localStorage.setItem(favId, JSON.stringify(content));
                        // console.log(starId);
                        // console.log(content);
                        $("#" + starId).removeClass("far fa-star");
                        $("#" + starId).addClass("yellow");
                        $("#" + starId).addClass("fas fa-star");
                        // console.log("fav");
                    }             
                    // console.log(starId);                   
                    // var td = icon + "," + favId + "," + name + "," + address;
                    // console.log("generateFavoritesable()");
                    // console.log("click");
                });
            });
        }

        function generateDetailTable(placeId) {
            var service = new google.maps.places.PlacesService(map);
            service.getDetails({
                placeId: placeId
            }, function(place, status) {
                initMap(place);
                destinationPlaceId = placeId;
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    generateDetailBar(place, placeId);
                    var tableInfo = getInfoTable(place);
                    // console.log("tableInfo:" + tableInfo);
                    // $("#infoTable").html(tableInfo);
                    $("#infoTable").html(tableInfo);
                    $("#photosTable").html(getPhotosTable(place));
                    // $("#mapTable").html(getMapTable(place));
                    getGoogleReviewsTable(place);
                    getYelpReviewsTable(place);
                }
            });
        }

        function getBackList() {
            console.log("back");
            var scope = angular.element($("#index")).scope();
            scope.$apply(function(){
                scope.showFull = true;
                console.log(scope.googleReviews);
            });
        }
        
        function generateDetailBar(place, placeId) {
            
            var favId = place.id + "_fav";
            var twitterId = place.id + "_twitter";
            var html_text = "";

            html_text += "<div id = 'detailTitle'><h4>"+ place.name +"</h4></div>";
            html_text += "<div class='d-flex'>";
            html_text += "<div class='mr-auto p-2'>";
            html_text += "<button class='btn btn-light detail_btn' type='button' onclick = 'getBackList()'>";
            html_text += "<i class='fas fa-chevron-left'></i>&nbsp;List";
            html_text += "</button></div>";
            html_text += "<div class='p-2'><button class='btn btn-light star_btn' type='button' id='" + favId  + "btn'>";
            html_text += "<i class='far fa-star' id='" + favId  + "'></i>";
            html_text += "</button></div>";
            html_text += "<div class='p-2'>";
            html_text += "<img src='Twitter.png' class = 'twitterIcon' id = "+ twitterId +">";
            html_text += "</div></div>";
            $("#detailBar").html(html_text);
            console.log(favId);
            console.log(placeId);
            if (placeId in localStorage) {
                $("#" + favId).removeClass("far fa-star");
                $("#" + favId).addClass("yellow");
                $("#" + favId).addClass("fas fa-star");
            }
            $(document).ready(function () { 
                
                $("#" + favId + "btn").off('click').on('click',function() {
                    console.log("sada");
                    if (placeId in localStorage) {
                        localStorage.removeItem(placeId);
                        // console.log(starId);
                        $("#" + placeId + "12").removeClass("fas fa-star");
                        $("#" + placeId + "12").removeClass("yellow");
                        $("#" + placeId + "12").addClass("far fa-star");
                        $("#" + favId).removeClass("fas fa-star");
                        $("#" + favId).removeClass("yellow");
                        $("#" + favId).addClass("far fa-star");

                    } else {
                        var content = {};
                        content["icon"] = place.icon;
                        content["favId"] = placeId;
                        content["name"] = place.name;
                        content["address"] = place.vicinity;
                        localStorage.setItem(placeId, JSON.stringify(content));
                        // console.log(starId);
                        // console.log(content);
                        $("#" + placeId + "12").removeClass("far fa-star");
                        $("#" + placeId + "12").addClass("yellow");
                        $("#" + placeId + "12").addClass("fas fa-star");
                        $("#" + favId).removeClass("far fa-star");
                        $("#" + favId).addClass("yellow");
                        $("#" + favId).addClass("fas fa-star");
                        // console.log("fav");
                    }
                });

                $("#" + twitterId).off('click').on('click',function() {
                    var urlName = "Share a link on Twitter"
                    var url = "https://twitter.com/intent/tweet?text=Check%20out%20" + place.name 
                            + "%20located%20at%20"+ place.formatted_address 
                            + ".%20Website:%20&url="+ place.website +"&hashtags=TravelAndEntertainmentSearch";
                    window.open(url, name, "height=300,width=800");
                });
            });   
        }   

        function getInfoTable(place) {
            // console.log(place.photos[1].getUrl());
            var html_text = "";
            html_text +="<table class='table table-striped'><tbody>"
            if (place.formatted_address) {
                // console.log("place.formatted_address");
                html_text +="<tr><th scope='row'>Address</th>";
                html_text +="<td>"+ place.formatted_address +"</td></tr>";
            }
            if (place.international_phone_number) {
                // console.log("place.international_phone_number");
                html_text +="<tr><th scope='row'>Phone Number</th>";
                html_text +="<td>"+ place.international_phone_number +"</td></tr>";
            }
            if (place.price_level) {
                // console.log("place.price_level");
                var level = "";
                for (var i = 0; i < place.price_level; i++) {
                    level += "$";
                }
                html_text +="<tr><th scope='row'>Price Level</th>";
                html_text +="<td>"+ level+"</td></tr>";
            }
            if (place.rating) {
                // console.log("place.formatted_address");
                html_text +="<tr><th scope='row'>Rating</th><td>";
                html_text +=getRating(place.rating);
                html_text +="</td></tr>";
            }
            if (place.url) {
                // console.log("place.url");
                html_text +="<tr><th scope='row'>Google Page</th>";
                html_text +="<td><a href='"+ place.url +"' target='"+ place.url +"'>"+ place.url +"</a></td></tr>";
            }
            if (place.website) {
                // console.log("place.website");
                html_text +="<tr><th scope='row'>Website</th>";
                html_text +="<td><a href='"+ place.website +"' target='"+ place.website +"'>"+ place.website +"</a></td></tr>";
            }
            if (place.opening_hours) {
                html_text +="<tr><th scope='row'>Hours</th><td>";
                html_text +=getOpeningHours(place.opening_hours);
                html_text +="</td></tr>";
            }

            html_text +="<tbody></table>";
            // console.log(html_text)
            return html_text;
        }

        function getPhotosTable(place) {
            var photos = place.photos;
            if (!photos) {
                return;
            }
            var html_text = "<div class='container'>";
            html_text += "<div class='card-columns card_photos'>";
            for (var i = 0; i < photos.length; i++) {
                var photo = photos[i].getUrl({'maxWidth': 1000, 'maxHeight': 1000});
                html_text += "<div class='card'><a href='"+ photo +"' target='_blank'><img alt='Card image cap' class='card-img-top img-fluid' src='"+ photo +"'></a></div>";
            }
            html_text += "	</div></div>";
            return html_text;
        }

        function getYelpReviewsTable(place) {
            console.log("yelp");
            console.log(place);
            var name = place.name;
            var city= "";
            var state = "";
            var country = "";
            var address1 = place.vicinity;

            var address_components = place.address_components;
            for (var key in address_components) {
            	if (address_components[key].types[0] == "country") {
            		country = address_components[key].short_name;
            	}
            	if (address_components[key].types[0] == "administrative_area_level_1") {
            		state = address_components[key].short_name;
            	}
            	if (address_components[key].types[0] == "administrative_area_level_2") {
            		city = address_components[key].short_name;
            	}
            }
                
            var rest = "name=" + name + "&city=" + city + "&state=" + state + 
                               "&country=" + country + "&address1=" + address1;
                            //    console.log("yelp");
                            //    console.log(rest);
            $.ajax({
                url: "http://kailaihm8-env.us-east-2.elasticbeanstalk.com/yelp?" + rest,
                // type: "GET",
                // contentType: 'application/x-www-form-urlencoded', //here it is
                // crossDomain: true,
                success: function (response) {
                    console.log("yelp");
                    console.log(JSON.parse(response).error);
                    if (JSON.parse(response).error == 0) {
                        var content= JSON.parse(response).data;
                        var reviews = JSON.parse(content).reviews;
                        var yelpReviews = [];
                        for (var i = 0; i < reviews.length; i++) {
                            var yelpReview = {};
                            var review = reviews[i];
                            yelpReview["name"] = review.user.name;
                            yelpReview["page"] = review.url;
                            yelpReview["rating"] = review.rating * 20;
                            yelpReview["time"] = review.time_created;
                            yelpReview["comment"] = review.text;
                            yelpReview["photo"] = review.user.image_url;
                            yelpReviews.push(yelpReview);
                        }
                        console.log(yelpReviews);
                        var scope = angular.element($("#index")).scope();
                        scope.$apply(function(){
                            scope.yelpReviews = yelpReviews;
                        });
                        $("#yelpReviewTable_noRecord").hide();
                    } else {
                        $("#yelpReviewTableContent").hide();
                        $("#yelpReviewTable_noRecord").show();
                        var scope = angular.element($("#index")).scope();
                        scope.$apply(function(){
                            scope.yelpReviews = [];
                        });
                        console.log("no yelp");
                    }
                }
            }); 
        }

        function getGoogleReviewsTable(place) {
            console.log("place.reviews:");
            console.log(place.reviews);
            if (place.reviews) {
                var reviews = place.reviews;
                var googleReviews = [];
                for (var i = 0; i < reviews.length; i++) {
                    var googleReview = {};
                    var review = reviews[i];
                    var name = review.author_name;
                    var page = review.author_url;
                    var rating = review.rating;
                    var time = review.time;
                    var time = moment.unix(time).format();
                    var time = time.substring(0,10) + " " + time.substring(11,19);
                    var comment = review.text;
                    var photo = review.profile_photo_url;
                    googleReview["name"] = name;
                    googleReview["page"] = page;
                    googleReview["rating"] = rating * 20;
                    googleReview["time"] = time;
                    googleReview["comment"] = comment;
                    googleReview["photo"] = photo;
                    googleReviews.push(googleReview);
                }
                var scope = angular.element($("#index")).scope();
                scope.$apply(function(){
                    scope.googleReviews = googleReviews;
                    console.log(scope.googleReviews);
                });

            } else {
                $("#googleReviewTableContent").hide();
                $("#googleTable_noRecord").show();
                var scope = angular.element($("#index")).scope();
                scope.$apply(function(){
                    scope.googleReviews = [];
                });
                console.log("no google");
            }
        }
        
        function getOpeningHours(openingHours) {
            var html_text="";
            var modal_text="";
            modal_text +="<div id='timeTable' class='modal fade' tabindex='-1' role='dialog' aria-labelledby='timeTableLabel' style='display: none;' aria-hidden='true'>";
            modal_text +="<div class='modal-dialog'  style='z-index: 1100;' role='document'>";
            modal_text +="<div class='modal-header'>";
            modal_text +="<h5 class='modal-title' id='timeTableLabel'>Open hours</h5>";
            modal_text +="<button type='button' onclick='document.getElementById('timeTable').style.display='none'' class='close' data-dismiss='modal' aria-label='Close'>";
            modal_text +="<span aria-hidden='true'>×</span>";
            modal_text +="</button><br><br></div>";
            modal_text +="<div class='modal-body time_font container'>";
            var day = {};
            day[0] = "Sunday";
            day[1] = "Monday";
            day[2] = "Tuesday";
            day[3] = "Wednesday";
            day[4] = "Thursday";
            day[5] = "Friday";
            day[6] = "Saturday";

            var dayReverse = {};
            dayReverse["Sunday"] = "0";
            dayReverse["Monday"] = "1";
            dayReverse["Tuesday"] = "2";
            dayReverse["Wednesday"] = "3";
            dayReverse["Thursday"] = "4";
            dayReverse["Friday"] = "5";
            dayReverse["Saturday"] = "6";

            var localtime = moment().local().format('YYYY-MM-DD HH:mm:ss');
            var newtime = moment().utc(localtime).utcOffset(-240).format('YYYY-MM-DD HH:mm:ss');
            var today = moment(newtime).format('dddd');
            var number = dayReverse[today];
            console.log("number:"+ number);
            console.log("today:"+ today);
            var open_now = "closed";
            var time = getOpen(openingHours.periods[number].open.hours) + "&nbsp;-&nbsp;" + getClose(openingHours.periods[number].close.hours);
            console.log("time:"+ time);
            if (openingHours.open_now) {
                open_now = "Open now:" + time;
            } 
            for (var i = number; i < (parseInt(number) + 7); i++) {
                var order = i;
                console.log(order);
                
                order = order % 7;

                var dow = day[order];
                var open  = openingHours.periods[order].open.hours;
                open = getOpen(open);
                var close  = openingHours.periods[order].close.hours;
                close = getClose(close);
                time = open + "&nbsp;-&nbsp;" + close;
                if (i == number) {
                    modal_text +="<div class = 'time_font row'>";
                    modal_text +="<div class='col-5'><strong>"+ dow +"</strong></div>";
                    modal_text +="<div class='col-7'><strong>"+ time +"</strong></div>";
                    modal_text +="</div><hr>";
                } else {
                    modal_text +="<div class = 'time_font row'>";
                    modal_text +="<div class='col-5'>"+ dow +"</div>";
                    modal_text +="<div class='col-7'>"+ time +"</div>";
                    modal_text +="</div><hr>";
                }
            }
            modal_text +="</div>";
            modal_text +="<div class='modal-footer'>";
            modal_text +="<button type='button' onclick='document.getElementById('timeTable').style.display='none'' class='btn btn-secondary' data-dismiss='modal'>Close</button>";
            modal_text +="</div></div></div></div>";

            $("#modal").html(modal_text);
            html_text +="<span>"+ open_now +"&nbsp;&nbsp;<a href='#timeTable' data-toggle='modal'>Daily open hours</a></span>"; 
            return html_text;           
        }
        
        function getClose(close) {
            if ((close / 12) >= 0 && (close / 12) <= 1) {
                close = close.toString() + ":00&nbsp;AM";
            } else if ((close / 12) > 1) {
                close = close % 12; 
                close = close  + ":00&nbsp;PM";
            }
            return close;
        }

        function getOpen(open) {
            if ((open / 12) >= 0 && (open / 12) <= 1) {
                open = open.toString()  + ":00&nbsp;AM";
            } else if ((open / 12) > 1) {
                open = open % 12; 
                open = open.toString() + ":00&nbsp;PM";
            }
            return open;
        }

        function getRating(rating) {
            var width = rating * 20;
            var html_text ="";
            html_text +="<div class = 'rating'><span class='rating-word'>"+ rating +"&nbsp;</span><div class='rating-star'>";
            html_text +="<div class='rating-star-top' style='width: "+ width +"%'>";
            html_text +="<span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>";
            html_text +="</div></div></div>";
            return html_text;
        }


        function getDistance(dis) {
            if (dis != "") {
                if (dis >= 0 && dis <= 31) {
                    distance = 16093 * $("#distance").val();
                } else {
                    distance = 0;
                }
            } else {
                distance = 160930;
            }
            return distance;
        }
        
        function generateFavoritesable() {
            // console.log("1");
            retrieveLocalStorage();
            // console.log("2");
            // console.log(favorites);
            var html_text = "";
            html_text += "<table class='table'>";
            html_text += "<thead><tr>";
            html_text += "<th scope='col'>#</th>";
            html_text += "<th scope='col'>Category</th>";
            html_text += "<th scope='col'>Name</th>";
            html_text += "<th scope='col'>Address</th>";
            html_text += "<th scope='col'>Favorite</th>";
            html_text += "<th scope='col'>Details</th>";
            html_text += "</tr></thead>";
            var i = 1;
            
            // for (var i = 0; i < favorites.length; i++) {
            //     var item = favorites[i];
            // }

            // console.log(favorites);
            for (fav in favorites) {
                var info = favorites[fav];
                var favId = info.favId;
                // console.log(favorites[fav]);
                // console.log("favtable:" + favId);
                if (typeof(favId) == "string") { 
                    var length = favId.length;
                    var detailId = favId.substring(0, length - 1);
                    // console.log(localStorage.key(favId));
                    // console.log(info);
                    html_text += "<tbody><tr>";
                    html_text += "<th scope='row' class='resultNum'>" + i + "</th>";
                    html_text += "<td width = 100px height = 40px><img src='" + info.icon + "' class = 'resultIcon'</td>";
                    html_text += "<td class='resultName'>" + info.name + "</td>";
                    html_text += "<td class='resultAddress'>" + info.address + "</td>";
                    html_text += "<td><button class='btn btn-light trash_btn' type='button' ng-click='refreshFavorites()' id='" + favId + "9'>";
                    html_text += "<i class='fas fa-trash-alt' id='" + favId  + "99'></i>";
                    html_text += "</button></td>";
                    html_text += "<td><button class='btn btn-light detail_btn' id='"+ favId +"' type='button'>";
                    html_text += "<i class='fas fa-chevron-right'></i>";
                    html_text += "</button></td>";
                    html_text += "</tr></tbody>";
                    i++;
                }
            }
            html_text += "</table>";
            // console.log("3");
            return html_text;
        }

        function generateResultsTable(content) {
                    // console.log("enter");
            var html_text = "";
            html_text += "<table class='table'>";
            html_text += "<thead><tr>";
            html_text += "<th class='t' scope='col'>#</th>";
            html_text += "<th class='t' scope='col'>Category</th>";
            html_text += "<th class='t' scope='col'>Name</th>";
            html_text += "<th class='t' scope='col'>Address</th>";
            html_text += "<th class='t' scope='col'>Favorite</th>";
            html_text += "<th class='t' scope='col'>Details</th>";
            html_text += "</tr></thead>";
            for (var i = 1; i <= content.length; i++) {
                var info = content[i - 1];
                html_text += "<tbody><tr>";
                html_text += "<th class='t' scope='row' class='resultNum'>" + i + "</th>";
                html_text += "<td class='t' width = 100px height = 40px><img src='" + info.icon + "' class = 'resultIcon'</td>";
                html_text += "<td class='t' class='resultName'>" + info.name + "</td>";
                html_text += "<td class='resultAddress t'>" + info.vicinity + "</td>";
                html_text += "<td class='t' ><button class='btn btn-light star_btn' type='button' ng-click='changeFav()' id='" + info.place_id  + "1'>";
                html_text += "<i class='far fa-star' id='" + info.place_id  + "12'></i>";
                html_text += "</button></td>";
                html_text += "<td class='t' ><button class='btn btn-light detail_btn' id='"+ info.place_id +"' type='button'>";
                html_text += "<i class='fas fa-chevron-right'></i>";
                html_text += "</button></td>";
                html_text += "</tr></tbody>";
            }
            html_text += "</table>";
            addFavColor();
            return html_text;
        }

        function retrieveLocalStorage() {
            favorites = [];

            var count = 1;
            for (var key in localStorage) {
                // console.log("???:" +key);
                if (localStorage.hasOwnProperty(key)) {
                    var item_str = localStorage.getItem(key);
                    // cS
                    // console.log(item);
                    // console.log(JSON.parse(item));
                    if (IsJsonString(item_str)) {
                        var fav = JSON.parse(item_str);
                        // console.log(fav);
                        favorites.push(fav);
                        // console.log(key);
                        // count++;
                        // console.log(count);
                        // console.log(fav);
                    }
                }
            }
        }

        function IsJsonString(str) {
            try {
                JSON.parse(str);
            } catch (e) {
                return false;
            }
            return true;
        }
    </script>
<script>
    function initMap(place) {
        var latt = place.geometry.location.lat();
        var lngg = place.geometry.location.lng();
        $("#destination-input").val(place.name + ", " +place.formatted_address);
        $("#origin-input").val(originAddressInput);
        getPlaceIdByAddress(originAddressInput);
        $("#destination-input").prop("disabled", true);
        var currentPlace = {lat: latt, lng: lngg};
        var map = new google.maps.Map(document.getElementById('map'), {
          mapTypeControl: false,
          center: {lat: latt, lng: lngg},
          zoom: 13
        });

        var marker = new google.maps.Marker({
		    position: {lat: latt, lng: lngg},
		    map: map
		});
        console.log("here1");
        // street view
        addStreetView(map, currentPlace);
        console.log("here2");
        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer;
        directionsDisplay.setMap(map);
        directionsDisplay.setPanel(document.getElementById("direction-panel"));
        console.log("here3");
        // bind the autocomplete to map, change the des and ori as u typed 
        new AutocompleteDirectionsHandler(map);
        console.log("here4");
        // show route
         $("#getDirection").on('click',function() {
            //  console.log(originPlaceId);
            //  console.log(destinationPlaceId);
            var input = $("#origin-input").val();
            if (input == "" || input == "My location") {
                originPlaceId = myPlaceId;
            } 
            getRoute(directionsService, directionsDisplay);
            marker.setMap(null);

          });
          console.log("here5");
      }

      function getRoute(directionsService, directionsDisplay) {
            var travelMode = $("#travelMode").val();
            directionsService.route({
                origin: {'placeId': originPlaceId},
                destination: {'placeId': destinationPlaceId},
                travelMode: travelMode,
                provideRouteAlternatives:true
                }, function(response, status) {
                if (status === 'OK') {
                    console.log("hao");
                    directionsDisplay.setDirections(response);
                } else {
                    window.alert('Directions request failed due to ' + status);
                    console.log("buhao");
                }
            });
      }

      function addStreetView(map, currentPlace) {
        panorama = map.getStreetView();
        panorama.setPosition(currentPlace);
        panorama.setPov(/** @type {google.maps.StreetViewPov} */({
          heading: 265,
          pitch: 0
        }));
      }

      function toggleStreetView() {
        var toggle = panorama.getVisible();
        if (toggle == false) {
            $("#changeView").attr("src", "Map.png");
            panorama.setVisible(true);
        } else {
            panorama.setVisible(false);
            $("#changeView").attr("src", "Pegman.png");
        }        
      }


      // @constructor
      function AutocompleteDirectionsHandler(map) {
        console.log("hd1");
        var originInput = document.getElementById('origin-input');
        var destinationInput = document.getElementById('destination-input');
        // var modeSelector = document.getElementById('mode-selector');
        console.log("hd11")
        var originAutocomplete = new google.maps.places.Autocomplete(
            originInput, {placeIdOnly: true});
        var destinationAutocomplete = new google.maps.places.Autocomplete(
            destinationInput, {placeIdOnly: true});
        console.log("hd2");
        this.setupPlaceChangedListener(originAutocomplete, 'ORIG', map);
        this.setupPlaceChangedListener(destinationAutocomplete, 'DEST', map);

      }


      // 要记录的东西 就是 travelMode    From end 

      // 解决了autocomplete和text的绑定 并自动赋值placeId
      AutocompleteDirectionsHandler.prototype.setupPlaceChangedListener = function(autocomplete, mode, map) {
        console.log("hd3");
        autocomplete.bindTo('bounds', map);
        autocomplete.addListener('place_changed', function() {
          var place = autocomplete.getPlace();
          if (!place.place_id) {
            window.alert("Please select an option from the dropdown list.");
            return;
          }
          if (mode === 'ORIG') {
            originPlaceId = place.place_id;
          } else {
            destinationPlaceId = place.place_id;
          }
        });
      };
</script>



</head>


<body id="index" ng-app="MyApp" ng-controller="MainCtrl">
    <div id="modal"></div>

<!---------------------------------------- 分割线 ------------------------>

<!---------------------------------------- 分割线 ------------------------>

    <div ng-controller="AppController as ctrl" layout="column" ng-cloak="" class="container card card-top" ng-model-options="{debounce: 200}">
        <h1 class="form_title">Travel and entertainment Search</h1>
        <form class="form-horizontal" id="form">

            <div class="form-group row">
                <label class="col-md-2 offset-md-2 col-form-label">Keyword
                    <span style="color:red">*</span>
                </label>
                <div class="col-md-5 offset-md-1">
                    <input id ="keyword" class="form-control">
                    <div id="invalid_input" class="invalid-feedback">
                        Please enter the keyword.
                    </div>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-md-3 offset-md-2 col-form-label">Category</label>
                <!-- <select id="category" class="form-control col-md-3 offset-md-1" ng-model="selected" ng-options="value.id as value.value for value in search_types">
                </select> -->
                <select id="category" class="form-control col-md-3 offset-md-1" ng-model="selected">
                    <option ng-repeat="option in search_types" value="{{option.id}}">{{option.value}}</option>
                </select>
            </div>

            <div class="form-group row">
                <label class="col-md-2 offset-md-2 col-form-label">Distance (miles)</label>
                <div class="col-md-3 offset-md-1">
                    <input id ="distance" class="form-control" placeholder="10">
                </div>
            </div>

            <!-- <fieldset class="form-group"> -->
            <div class="form-group row">
                <legend class="col-form-label col-md-2 offset-md-2">From
                    <span style="color:red">*</span>
                </legend>
                <div class="col-md-4 offset-md-1">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="start" id="currentLocation" value="currentLocation" checked>
                        <label class="form-check-label normal_word" for="currentLocation">
                        <span class="normal_word">Current location</span>
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="start" id="otherLocation" value="otherLocation">
                        <label class="form-check-label" for="otherLocation">
                        <span class="normal_word">Other. Please specify:</span>
                        
                        <div>
                            <input id ="otherLocationText" class="form-control" placeholder="Enter a location">
                            <div id="invalid_input_2" class="invalid-feedback">
                                Please enter the keyword.
                            </div>
                        </div>
                        </label>
                    </div>
                </div>
            </div>
            <!-- </fieldset> -->
            <div class="offset-md-2 col-md-3">
                <button type="button" ng-click="showResult()" id="search" class="btn btn-primary">
                        <i class="fas fa-search"></i> &nbsp;Search
                </button>
                <button type="button" ng-click="clearShow()" id="clear_btn" class="btn btn-default">
                    Clear
                </button>
            </div>
        </form>   
    </div>

    <div class = "card-body">
        <ul class="nav nav-pills mb-2 justify-content-center" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" data-toggle="pill" href="#result_table" role="tab" ng-click = "refreshResults()"aria-controls="result_table" aria-selected="true">Results</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="pill" href="#favorite_table" role="tab" ng-click = "refreshFavorites()" aria-controls="favorite_table" aria-selected="false">Favorites</a>
            </li>
        </ul>      
    </div>

    

   <div class="container card-body" id="placeDetails">
       <div class="animate-switch-container">

            <div id="content1" class="animate-switch panel panel-default" ng-show="showFull"> 
                <div id="result_content">
                    <div class="d-flex flex-row-reverse">
                        <button class="btn btn-default p-2 currentDetail_btn" type="button" ng-click="slideCurrentShow()" id="currentDetail">
                            Details <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>        
                <div class="tab-content">
                    <div class="card-body tab-pane fade show active" id="result_table" aria-labelledby="result_table-tab" role="tabpanel">
                        <div class="progress" id ="table_loading">
                            <div class="progress-bar progress-bar-striped progress-bar-animated progressBar" style="width:50%" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    
                        <div class="alert alert-danger" id="table_error">
                            Failed to get search results.
                        </div>
                
                        <div class="alert alert-warning" id="table_noRecord">
                            No records. 
                        </div>

                        <div id = "resultTable" class="table-responsive"></div>

                        <div class="offset-md-2 col-md-3">
                            <button type="button" ng-click="showPrevious()" ng-show = "hasPrevious" id="previous_btn" class="btn btn-default">
                                Previous
                            </button>
                            <button type="button" ng-click="showNext()" ng-show = "hasNext" id="next_btn" class="btn btn-default">
                                Next
                            </button>
                        </div>
                    </div>
                    <div class="card-body tab-pane fade" id="favorite_table" aria-labelledby="favorite_table-tab" role="tabpanel">

                        <div class="alert alert-warning" id="table_noRecordFav">
                            No records. 
                        </div>

                        <div id = "favoriteTable"></div>
                    </div>
                </div>
            </div>

            <div id="content2" class="animate-switch2" ng-show="!showFull">
                <div id = "detailBar"></div>
                <nav>
                    <div class="nav nav-tabs justify-content-end" id="nav-tab" role="tablist">
                        <a class="nav-item nav-link active" id="nav-info-tab" data-toggle="tab" href="#nav-info" role="tab" aria-controls="nav-info" aria-selected="true">Info</a>
                        <a class="nav-item nav-link" id="nav-photos-tab" data-toggle="tab" href="#nav-photos" role="tab" aria-controls="nav-photos" aria-selected="false">Photos</a>
                        <a class="nav-item nav-link" id="nav-map-tab" data-toggle="tab" href="#nav-map" role="tab" aria-controls="nav-map" aria-selected="false">Map</a>
                        <a class="nav-item nav-link" id="nav-reviews-tab" data-toggle="tab" href="#nav-reviews" role="tab" aria-controls="nav-contreviewsact" aria-selected="false" ng-click = "showGoogle()">Reviews</a>
                    </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-info" role="tabpanel" aria-labelledby="nav-info-tab">
                        <div id ="infoTable" class="table-responsive"></div>
                    </div>
                    <div class="tab-pane fade" id="nav-photos" role="tabpanel" aria-labelledby="nav-photos-tab">
                        <div id="photosTable"></div>
                    </div>
                    <div class="tab-pane fade" id="nav-map" role="tabpanel" aria-labelledby="nav-map-tab">
                            <form>
                                <div class="form-row" id = "map_nav">
                                    <div class="form-group col-md-4">
                                        <label for="origin-input">From</label>
                                        <input id="origin-input" class="form-control" placeholder="Your Location" type="text">
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label for="destination-input">To</label>
                                        <input id="destination-input" class="form-control" placeholder="Enter a destination location" type="text">
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label>Travel Mode</label>
                                        <select class="custom-select" id = "travelMode">
                                            <option value="DRIVING" selected>Driving</option>
                                            <option value="BICYCLING">Bicycling</option>
                                            <option value="TRANSIT">Transit</option>
                                            <option value="WALKING">Walking</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-2 align-self-end">
                                        <button type="button" ng-click="gerDirection()" id="getDirection" class="btn btn-primary">
                                                <i class="fas fa-search"></i> Get Direction
                                        </button>
                                    </div>
                                </div>
                            </form>
                            <!-- toggle street view -->
                            <div id="floating-panel">
                                <img src="Pegman.png" alt="" onclick="toggleStreetView()"; id="changeView">
                            </div>
                            
                            <div id="map"></div>
                            <div id="direction-panel"></div>
                    </div>
                    <div class="tab-pane fade" id="nav-reviews" role="tabpanel">
                        <div id="reviewsTable">
                            <!-- 分界线 -->
                            <div class='container'>
                                    <div class="row">
                                        <!-- <div class="col-md-3 col-xs-12"> -->
                                            <div class="dropdown col-md-3 col-6">
                                                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                Google Reviews 
                                                </button>
                                                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                    <ul class="nav nav-pills" id="pills-tab" role="tablist">
                                                        <li class="nav-item dropdown-item">
                                                            <a ng-click="showGoogle()" class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#googleReviewTable" role="tab" aria-controls="pills-home" aria-selected="true">Google Reviews</a>
                                                        </li>
                                                        <li class="nav-item dropdown-item">
                                                            <a ng-click="showYelp()" class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#yelpReviewTable" role="tab" aria-controls="pills-profile" aria-selected="false">Yelp Reviews</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>

                                            <div class="dropdown col-md-3 col-6">
                                                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    Default Order
                                                </button>
                                                <div class ="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                                    <ul class="nav nav-pills" id="pills-tab" role="tablist">
                                                    <li class="nav-item dropdown-item">
                                                        <a class="nav-link active" ng-click="sortBy('default')" data-toggle="pill" href="#" role="tab" aria-controls="pills-home" aria-selected="true">Default Order</a>
                                                    </li>
                                                    <li class="nav-item dropdown-item">
                                                        <a class="nav-link" ng-click="sortBy('highest')" data-toggle="pill" href="#" role="tab" aria-controls="pills-profile" aria-selected="false">Highest Rating</a>
                                                    </li>
                                                    <li class="nav-item dropdown-item">
                                                        <a class="nav-link" ng-click="sortBy('lowest')" data-toggle="pill" href="#" role="tab" aria-controls="pills-contact" aria-selected="false">Lowest Rating</a>
                                                    </li>
                                                    <li class="nav-item dropdown-item">
                                                        <a class="nav-link" ng-click="sortBy('mostRecent')" data-toggle="pill" href="#" role="tab" aria-controls="pills-contact" aria-selected="false">Most Recent</a>
                                                    </li>
                                                    <li class="nav-item dropdown-item">
                                                        <a class="nav-link" ng-click="sortBy('leastRecent')" data-toggle="pill" href="#" role="tab" aria-controls="pills-contact" aria-selected="false">Least Recent</a>
                                                    </li>
                                                    </ul>
                                                </div>
                                            </div>
                                    </div>

                                    <!-- Default Order, Highest Rating, Lowest Rating, Most Recent and Least Recent. -->
 
                                    <div class='tab-content clearfix pt-3'>
                                      <div class='tab-pane active' id='googleReviewTable'>
                                        <tr>
                                          <table class="table fadein" ng-if="bool=='googleShow'" id ="googleReviewTableContent" ng-repeat="googleReview in googleReviews | orderBy:propertyName:reverse">
                                            <tbody>
                                                <td class="row">
                                                  <div class="col-md-1 col-2 col-sm-2">
                                                    <a href="{{googleReview.page}}" target='{{googleReview.page}}'><img id = "yelpReviewImage" src="{{googleReview.photo}}"></a>
                                                  </div>
                                                  <div class="col-md-11 col-10 col-sm-10">
                                                    <div class="reviewName">
                                                      <a href="{{googleReview.page}}" target='{{googleReview.page}}'>
                                                      {{googleReview.name}}
                                                      </a>
                                                    </div>
                                                    <div class="reviewRating row">
                                                      <span class="rating-word"></span> &nbsp;&nbsp;
                                                      <div class="rating-star">
                                                        <div class="rating-star-top" style="width: {{googleReview.rating}}%">
                                                        <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
                                                        </div>
                                                      </div>
                                                      <span class="rating-word">&nbsp;{{googleReview.time}}</span>
                                                    </div>
                                                    <div class="reviewComment">{{googleReview.comment}}</div>
                                                  </div>
                                                </td>
                                            </tbody>
                                          </table>
                                          <div class="alert alert-warning fadein" ng-if="bool=='googleNoRecord'" id="googleTable_noRecord">
                                            No records. 
                                          </div>
                                        </tr>
                                      </div>
                                      <div class='tab-pane' id='yelpReviewTable'>                            
                                            <table class="table fadein" ng-if="bool=='yelpShow'" id='yelpReviewTableContent' ng-repeat="yelpReview in yelpReviews | orderBy:propertyName:reverse">
                                                <tbody>
                                                    <td class="row">
                                                    <div class="col-md-1">
                                                        <a href="{{yelpReview.page}}" target='{{yelpReview.page}}'><img id = "reviewImage" src="{{yelpReview.photo}}"></a>
                                                    </div>
                                                    <div class="col-md-11">
                                                        <div class="reviewName">
                                                        <a href="{{yelpReview.page}}" target='{{yelpReview.page}}'>
                                                        {{yelpReview.name}}
                                                        </a>
                                                        </div>
                                                        <div class="reviewRating row">
                                                        <span class="rating-word"></span> &nbsp;&nbsp;
                                                        <div class="rating-star">
                                                            <div class="rating-star-top" style="width: {{yelpReview.rating}}%">
                                                            <span>★</span><span>★</span><span>★</span><span>★</span><span>★</span>
                                                            </div>
                                                        </div>
                                                        <span class="rating-word">&nbsp;{{yelpReview.time}}</span>
                                                        </div>
                                                        <div class="reviewComment">{{yelpReview.comment}}</div>
                                                    </div>
                                                    </td>
                                                </tbody>
                                            </table>
                                            <div ng-if="bool=='yelpNoRecord'" class = "fadein">
                                                <div class="alert alert-warning" id="yelpReviewTable_noRecord">
                                                    No records. 
                                                </div>
                                            </div>
                                      </div>
                                    </div>
                                  </div>
                            <!-- 分界线 -->
                        </div>
                    </div>
                </div>
            </div>
       </div>
   </div>
</body>
</html>

